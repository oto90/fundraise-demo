<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Helping Hand â€” Fundraise Up GA4 Demo</title>
  
  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T9JS51CFMT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    
    // Configure GA4 with send_page_view enabled
    gtag("config", "G-T9JS51CFMT", {
      debug_mode: true,
      send_page_view: true
    });
    
    console.log("âœ… GA4 initialized with debug mode");
    console.log("   Measurement ID: G-T9JS51CFMT");
    console.log("   Page view will be sent automatically");
  </script>

  <!-- Enable Test Mode -->
  <script>
    window.fundraiseup_livemode = false;
  </script>

  <!-- Fundraise Up widget -->
  <script>
    (function (w, d, s, n, a) {
      if (!w[n]) {
        var l = "call,catch,on,once,set,then,track".split(","), i,
        o = function (n) {
          return typeof n === "function"
            ? o.l.push([arguments]) && o
            : function () { return o.l.push([n, arguments]) && o; };
        },
        t = d.getElementsByTagName(s)[0],
        j = d.createElement(s);
        j.async = true;
        j.src = "https://cdn.fundraiseup.com/widget/" + a;
        t.parentNode.insertBefore(j, t);
        o.s = Date.now();
        o.v = 4;
        o.h = w.location.href;
        o.l = [];
        for (i = 0; i < 7; i++) o[l[i]] = o(l[i]);
        w[n] = o;
      }
    })(window, document, "script", "FundraiseUp", "AEMZUDUM");
  </script>
</head>
<body style="font-family: system-ui, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px;">
  <h1>Helping Hand â€” Fundraise Up GA4 Demo</h1>
  
  <!-- Donate Button -->
  <a href="#XJKDHSTQ" id="donate-button" style="display: inline-block; background: #2196F3; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; margin: 20px 0;">Donate Now</a>

  <script>
    console.log("ğŸ”§ Starting FundraiseUp + GA4 Integration");

    // Use FundraiseUp.on() API method for proper event tracking
    FundraiseUp.on('checkoutOpen', function(details) {
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      console.log("ğŸ‰ CHECKOUT OPENED");
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      console.log("Full details:", details);
      
      gtag('event', 'begin_checkout', {
        currency: 'USD',
        value: 0
      });
      
      console.log("âœ… begin_checkout sent to GA4");
      console.log("");
    });
    
    FundraiseUp.on('donationComplete', function(details) {
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      console.log("ğŸ‰ DONATION COMPLETED");
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      console.log("Full details:", details);
      
      // Extract donation data
      var donation = details.donation || {};
      var campaign = details.campaign || {};
      
      var amount = Number(donation.amount) || 0;
      var currency = donation.currency || 'USD';
      var transactionId = donation.id || 'T' + Date.now();
      var campaignId = campaign.id || 'GENERAL';
      var campaignName = campaign.name || 'General Donation';
      
      console.log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
      console.log("ğŸ“Š Extracted Data:");
      console.log("   Amount:", amount);
      console.log("   Currency:", currency);
      console.log("   Transaction ID:", transactionId);
      console.log("   Campaign ID:", campaignId);
      console.log("   Campaign Name:", campaignName);
      console.log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
      
      // Create items array with REQUIRED fields per GA4 spec
      // Each item MUST have item_id or item_name (we include both)
      var items = [{
        item_id: campaignId,
        item_name: campaignName,
        item_category: "Donation",
        price: amount,
        quantity: 1
      }];
      
      // Send GA4 purchase event - EXACTLY as per GA4 documentation
      var purchaseEventData = {
        currency: currency,
        transaction_id: transactionId,
        value: amount,
        items: items,
        // Add additional parameters for better reporting
        donation_amount: amount,
        campaign_name: campaignName,
        payment_method: donation.paymentMethod || 'unknown'
      };
      
      console.log("ğŸ“¦ Sending purchase event to GA4:");
      console.log(JSON.stringify(purchaseEventData, null, 2));
      
      // Send the purchase event
      gtag('event', 'purchase', purchaseEventData);
      
      console.log("âœ… purchase event sent to GA4");
      console.log("   This should appear in:");
      console.log("   - DebugView immediately (if you have it open)");
      console.log("   - Realtime report within ~30 seconds");
      console.log("   - E-commerce reports within 24-48 hours");
      
      // Also send donation_completed custom event
      gtag('event', 'donation_completed', {
        currency: currency,
        value: amount,
        transaction_id: transactionId,
        campaign_name: campaignName,
        donation_amount: amount,
        payment_method: donation.paymentMethod || 'unknown',
        is_recurring: donation.recurring || false
      });
      
      console.log("âœ… donation_completed event sent to GA4");
      console.log("");
      
      // Wait a moment then verify it's in dataLayer
      setTimeout(function() {
        console.log("ğŸ” Verifying dataLayer contents:");
        var purchaseEvents = window.dataLayer.filter(function(item) {
          return item[0] === 'event' && item[1] === 'purchase';
        });
        console.log("Found", purchaseEvents.length, "purchase events in dataLayer");
        console.log("Last 5 dataLayer entries:", window.dataLayer.slice(-5));
        console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      }, 500);
    });
    
    console.log("âœ… FundraiseUp event listeners initialized");
    console.log("ğŸ› Debug mode enabled - check GA4 DebugView at:");
    console.log("   Admin > DebugView in your GA4 property");
    console.log("");
  </script>

  <!-- Info Panel -->
  <div style="margin-top: 40px; padding: 20px; background: #f0f7ff; border-left: 4px solid #2196F3;">
    <h3 style="margin-top: 0; color: #1565C0;">âœ… Integration Active</h3>
    <p><strong>Measurement ID:</strong> G-T9JS51CFMT</p>
    <p><strong>Debug Mode:</strong> Enabled</p>
    <p><strong>Events Being Tracked:</strong></p>
    <ul style="line-height: 1.8;">
      <li><code>begin_checkout</code> - When checkout modal opens</li>
      <li><code>purchase</code> - Complete transaction with amount, currency, and items array</li>
    </ul>
    <p style="margin-bottom: 0;"><strong>Method:</strong> FundraiseUp.on() JavaScript API with GA4-compliant data structure</p>
  </div>

  <!-- Testing Instructions -->
  <div style="margin-top: 20px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107;">
    <h3 style="margin-top: 0; color: #856404;">ğŸ“‹ VERIFICATION STEPS</h3>
    
    <div style="background: white; padding: 15px; margin: 15px 0; border-radius: 5px;">
      <h4 style="margin-top: 0; color: #856404;">STEP 1: Check Browser Console</h4>
      <ol style="line-height: 1.8; margin-bottom: 0;">
        <li>Open Developer Tools (F12)</li>
        <li>Go to Console tab</li>
        <li>Make a $700 donation</li>
        <li>Look for the boxed output showing extracted data</li>
        <li>Verify "Amount: 700" is displayed</li>
      </ol>
    </div>

    <div style="background: white; padding: 15px; margin: 15px 0; border-radius: 5px;">
      <h4 style="margin-top: 0; color: #856404;">STEP 2: Check GA4 DebugView (REAL-TIME)</h4>
      <ol style="line-height: 1.8; margin-bottom: 0;">
        <li>Open GA4 â†’ <strong>Admin</strong> â†’ <strong>DebugView</strong></li>
        <li>Make a $700 donation</li>
        <li>Watch for <code>purchase</code> event to appear</li>
        <li>Click on the <code>purchase</code> event</li>
        <li>Verify these parameters show:
          <ul>
            <li><code>value: 700</code></li>
            <li><code>currency: USD</code></li>
            <li><code>transaction_id: DXXXXXXX</code></li>
            <li><code>items: Array(1)</code></li>
          </ul>
        </li>
        <li>Expand <code>items</code> and verify:
          <ul>
            <li><code>item_id</code> is present</li>
            <li><code>item_name</code> is present</li>
            <li><code>price: 700</code></li>
          </ul>
        </li>
      </ol>
    </div>

    <div style="background: white; padding: 15px; margin: 15px 0; border-radius: 5px;">
      <h4 style="margin-top: 0; color: #856404;">STEP 3: Check GA4 Realtime Report</h4>
      <ol style="line-height: 1.8; margin-bottom: 0;">
        <li>Go to <strong>Reports</strong> â†’ <strong>Realtime</strong></li>
        <li>Scroll to "Event count by Event name"</li>
        <li>Click on <code>purchase</code> event</li>
        <li>Look for parameter details</li>
      </ol>
    </div>

    <div style="background: #e8f5e9; padding: 15px; margin: 15px 0; border-radius: 5px; border-left: 3px solid #4caf50;">
      <h4 style="margin-top: 0; color: #2e7d32;">ğŸ’¡ Important Notes</h4>
      <ul style="line-height: 1.8; margin-bottom: 0;">
        <li><strong>DebugView</strong> shows data IMMEDIATELY - this is your best testing tool</li>
        <li><strong>E-commerce reports</strong> take 24-48 hours to populate</li>
        <li><strong>Test card:</strong> 4242 4242 4242 4242, any future expiry, any CVC</li>
        <li>If DebugView shows the correct data, your implementation is working!</li>
      </ul>
    </div>
  </div>

  <!-- Quick Test Button -->
  <div style="margin-top: 20px; padding: 20px; background: #f3e5f5; border-left: 4px solid #9c27b0;">
    <h3 style="margin-top: 0; color: #6a1b9a;">ğŸ§ª Test Purchase Event (Fake Data)</h3>
    <p>Click this button to send a test $700 purchase event without making a real donation:</p>
    <button onclick="testPurchaseEvent()" style="background: #9c27b0; color: white; border: none; padding: 12px 24px; border-radius: 3px; cursor: pointer; font-size: 16px; font-weight: bold;">
      Send Test $700 Purchase Event
    </button>
    <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">This will help you verify GA4 is receiving the data correctly before making a real donation.</p>
  </div>

  <script>
    function testPurchaseEvent() {
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      console.log("ğŸ§ª SENDING TEST PURCHASE EVENT");
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      
      var testData = {
        currency: "USD",
        transaction_id: "TEST_" + Date.now(),
        value: 700,
        items: [{
          item_id: "TEST_CAMPAIGN",
          item_name: "Test Donation Campaign",
          item_category: "Donation",
          price: 700,
          quantity: 1
        }]
      };
      
      console.log("Test purchase data:", JSON.stringify(testData, null, 2));
      gtag('event', 'purchase', testData);
      console.log("âœ… Test purchase event sent!");
      console.log("Check GA4 DebugView now - you should see this event appear immediately");
      console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
      
      alert("Test purchase event sent! Check:\n\n1. Browser console for confirmation\n2. GA4 DebugView for the event\n3. Look for 'purchase' event with value: 700");
    }
  </script>
</body>
</html>
