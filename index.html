<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Helping Hand â€” Fundraise Up GA4 Demo</title>
  
  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T9JS51CFMT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-T9JS51CFMT");
  </script>

  <!-- Enable Test Mode -->
  <script>
    window.fundraiseup_livemode = false;
  </script>

  <!-- Fundraise Up widget -->
  <script>
    (function (w, d, s, n, a) {
      if (!w[n]) {
        var l = "call,catch,on,once,set,then,track".split(","), i,
        o = function (n) {
          return typeof n === "function"
            ? o.l.push([arguments]) && o
            : function () { return o.l.push([n, arguments]) && o; };
        },
        t = d.getElementsByTagName(s)[0],
        j = d.createElement(s);
        j.async = true;
        j.src = "https://cdn.fundraiseup.com/widget/" + a;
        t.parentNode.insertBefore(j, t);
        o.s = Date.now();
        o.v = 4;
        o.h = w.location.href;
        o.l = [];
        for (i = 0; i < 7; i++) o[l[i]] = o(l[i]);
        w[n] = o;
      }
    })(window, document, "script", "FundraiseUp", "AEMZUDUM");
  </script>
</head>
<body>
  <h1>Helping Hand â€” Fundraise Up GA4 Demo</h1>
  
  <!-- Donate Button -->
  <a href="#XJKDHSTQ" id="donate-button"></a>

  <script>
    console.log("ðŸ”§ Starting FundraiseUp + GA4 Integration");
    
    // Send test event
    gtag('event', 'page_ready', {
      event_category: 'test'
    });

    // Override dataLayer.push to intercept FundraiseUp events
    var originalPush = window.dataLayer.push;
    
    window.dataLayer.push = function() {
      var result = originalPush.apply(window.dataLayer, arguments);
      var data = arguments[0];
      
      if (data && typeof data === 'object') {
        console.log("ðŸ“¦ Event:", data.event);
        
        // CHECKOUT OPENED
        if (data.event === 'FundraiseUp.checkoutOpen') {
          console.log("ðŸŽ‰ CHECKOUT OPENED");
          
          gtag('event', 'checkout_opened', {
            event_category: 'fundraiseup',
            event_label: 'checkout_modal_opened'
          });
          
          console.log("âœ… checkout_opened sent to GA4");
        }
        
        // DONATION COMPLETED
        if (data.event === 'FundraiseUp.donationComplete') {
          console.log("ðŸŽ‰ DONATION COMPLETED");
          console.log("   Full data:", data);
          
          // Extract transaction details
          var amount = 0;
          var currency = 'USD';
          var transactionId = '';
          var campaignId = '';
          var campaignName = '';
          
          if (data.FundraiseUp && data.FundraiseUp.donation) {
            amount = data.FundraiseUp.donation.amount || 0;
            currency = data.FundraiseUp.donation.currency || 'USD';
            transactionId = data.FundraiseUp.donation.id || '';
          }
          
          if (data.FundraiseUp && data.FundraiseUp.campaign) {
            campaignId = data.FundraiseUp.campaign.id || '';
            campaignName = data.FundraiseUp.campaign.name || 'Donation';
          }
          
          console.log("   Amount:", amount, currency);
          console.log("   Transaction ID:", transactionId);
          
          // Send custom donation_completed event
          gtag('event', 'donation_completed', {
            event_category: 'fundraiseup',
            event_label: 'test_donation',
            value: amount,
            currency: currency,
            transaction_id: transactionId
          });
          
          console.log("âœ… donation_completed sent");
          
          // Send GA4 purchase event for e-commerce tracking
          gtag('event', 'purchase', {
            transaction_id: transactionId,
            value: amount,
            currency: currency,
            items: [{
              item_id: campaignId,
              item_name: campaignName,
              item_category: 'Donation',
              price: amount,
              quantity: 1
            }]
          });
          
          console.log("âœ… purchase event sent for e-commerce");
        }
      }
      
      return result;
    };
    
    console.log("âœ… Tracking initialized");
  </script>

  <!-- Info Panel -->
  <div style="margin-top: 40px; padding: 20px; background: #f0f7ff; border-left: 4px solid #2196F3; font-family: system-ui, sans-serif;">
    <h3 style="margin-top: 0; color: #1565C0;">âœ… Integration Active</h3>
    <p><strong>Tracking:</strong></p>
    <ul style="line-height: 1.8;">
      <li><code>checkout_opened</code> - When modal opens</li>
      <li><code>donation_completed</code> - When donation completes (with amount)</li>
      <li><code>purchase</code> - GA4 e-commerce event (for revenue tracking)</li>
    </ul>
    <p style="margin-bottom: 0;"><strong>Method:</strong> dataLayer event interception</p>
  </div>
</body>
</html>
